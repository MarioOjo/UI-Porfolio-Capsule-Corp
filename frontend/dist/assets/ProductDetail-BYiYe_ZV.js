import{W as L,l as D,r as c,X as z,j as e,A as K,Y as V,o as Y,m as H,n as Q,u as G,Z as P,L as X,$ as Z,a0 as J,t as ee,P as T,a1 as se,a2 as te,g as ae,p as re,a3 as le,a as ie,U as F}from"./index-C_rhaFlX.js";import{I as oe,P as ne}from"./ProductCard-Bl7CurD0.js";import{B as E}from"./Breadcrumb-BB42uieg.js";import{p as O}from"./products-B_SWgLtA.js";const ce=({productId:d,onClose:u})=>{const{addReview:f}=L(),{user:p}=D(),{showSuccess:y,showError:j}=K(),[x,a]=c.useState({rating:5,title:"",comment:""}),[s,h]=c.useState(!1),b=async o=>{o.preventDefault(),h(!0);try{await f({...x,productId:d,userId:p.id,userName:p.username||p.displayName}),y("âœ… Review submitted successfully!"),u()}catch{j("âŒ Failed to submit review")}finally{h(!1)}},m=o=>{a(t=>({...t,[o.target.name]:o.target.value}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true",tabIndex:-1,"aria-labelledby":"write-review-title",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 overflow-x-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{id:"write-review-title",className:"text-xl font-bold font-saiyan",children:"WRITE A REVIEW"}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rating *"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(o=>e.jsx("button",{type:"button",onClick:()=>a(t=>({...t,rating:o})),className:`text-2xl ${o<=x.rating?"text-yellow-400":"text-gray-300"} hover:text-yellow-400 transition-colors`,children:"â­"},o))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Review Title *"}),e.jsx("input",{type:"text",name:"title",value:x.title,onChange:m,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Summarize your experience..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Your Review *"}),e.jsx("textarea",{name:"comment",value:x.comment,onChange:m,required:!0,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-none",placeholder:"Share your thoughts about this product..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:s,className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-bold disabled:opacity-50 transition-colors",children:s?"Submitting...":"Submit Review"})]})]})]})})},de=({productId:d})=>{const{reviews:u,fetchReviews:f,markHelpful:p,getAverageRating:y,getRatingDistribution:j}=L(),{user:x}=D(),[a,s]=c.useState(!1);z.useEffect(()=>{f(d)},[d]);const h=y(d),b=j(d),m=u.length,o=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-500",children:h}),e.jsx("div",{className:"flex justify-center",children:[1,2,3,4,5].map(t=>e.jsx("span",{className:`text-lg ${t<=Math.round(h)?"text-yellow-400":"text-gray-300"}`,children:"â­"},t))}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[m," ",m===1?"review":"reviews"]})]}),e.jsx("div",{className:"flex-1",children:[5,4,3,2,1].map(t=>e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm w-8",children:[t,"â­"]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:m?`${b[t]/m*100}%`:"0%"}})}),e.jsx("span",{className:"text-sm text-gray-600 w-8",children:b[t]})]},t))})]}),x&&e.jsx("button",{onClick:()=>s(!0),className:"w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:"Write a Review"})]}),e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsx("div",{className:"flex items-start gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(k=>e.jsx("span",{className:`${k<=t.rating?"text-yellow-400":"text-gray-300"}`,children:"â­"},k))}),e.jsx("span",{className:"font-medium",children:t.userName}),t.verified&&e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Verified Purchase"}),e.jsx("span",{className:"text-gray-500 text-sm",children:o(t.date)})]}),e.jsx("h4",{className:"font-semibold mb-2",children:t.title}),e.jsx("p",{className:"text-gray-700 mb-3",children:t.comment}),e.jsxs("button",{onClick:()=>p(t.id),className:"text-sm text-gray-600 hover:text-orange-500 transition-colors",children:["ðŸ‘ Helpful (",t.helpful,")"]})]})})},t.id))}),a&&e.jsx(ce,{productId:d,onClose:()=>s(!1)})]})};function pe(){const{slug:d}=V(),u=Y(),{user:f}=D(),{addToCart:p}=H(),{addToWishlist:y,removeFromWishlist:j,isInWishlist:x}=Q(),{isDarkMode:a}=G(),[s,h]=c.useState(null),[b,m]=c.useState([]),[o,t]=c.useState(0),[k,$]=c.useState(!1),[N,I]=c.useState(1),[v,_]=c.useState("description"),[U,S]=c.useState(!0),[xe,C]=c.useState(null),n={background:a?"bg-gradient-to-br from-slate-900 to-slate-800":"bg-gradient-to-br from-blue-50 to-orange-50",card:a?"bg-slate-800 border border-slate-700":"bg-white border border-blue-100",text:{primary:a?"text-white":"text-gray-800",secondary:a?"text-gray-300":"text-gray-600",muted:a?"text-gray-400":"text-gray-500"}};c.useEffect(()=>{(async()=>{try{S(!0),C(null);try{const l=await F(`/api/products/slug/${d}`);if(l&&l.id){h(l);const q=(await F(`/api/products?category=${encodeURIComponent(l.category)}`)||[]).filter(M=>M.id!==l.id).slice(0,4);m(q),S(!1);return}}catch(l){console.warn("API fetch failed, trying local data:",l)}const i=O.find(l=>l.slug===d);if(i){h(i);const l=O.filter(R=>R.category===i.category&&R.id!==i.id).slice(0,4);m(l)}else C("Product not found")}catch(i){console.error("Error loading product:",i),C("Product not found")}finally{S(!1)}})()},[d]),c.useEffect(()=>{if(!s)return;const r=s.gallery?.[o]??s.image,i=P(r,800);$(!1);const l=new Image;return l.src=i,l.onload=()=>$(!0),l.onerror=()=>$(!1),()=>{l.onload=null,l.onerror=null}},[s,o]);const W=()=>{s&&(s.inStock||s.in_stock||s.stock>0)&&p(s,N)},B=()=>{s&&(x(s.id)?j(s.id):y(s))},A=r=>{const i=s?.stock||0;I(l=>Math.max(1,Math.min(i,l+r)))};if(U)return e.jsx("div",{className:`min-h-0 ${n.background} overflow-x-hidden`,children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 sm:py-16",children:[e.jsx(E,{}),e.jsxs("div",{className:"text-center mt-8 sm:mt-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 sm:h-24 w-16 sm:w-24 border-b-4 border-orange-500 mx-auto mb-4 sm:mb-6"}),e.jsx("p",{className:`font-saiyan text-lg sm:text-xl ${n.text.secondary}`,children:"Loading product..."})]})]})});if(!s)return e.jsx("div",{className:`min-h-0 ${n.background} overflow-x-hidden`,children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 sm:py-16",children:[e.jsx(E,{}),e.jsxs("div",{className:"text-center mt-8 sm:mt-12",children:[e.jsx("h1",{className:`text-2xl sm:text-4xl font-bold mb-4 font-saiyan ${n.text.primary}`,children:"PRODUCT NOT FOUND"}),e.jsx("p",{className:`${n.text.secondary} mb-6 sm:mb-8`,children:"The product you're looking for doesn't exist in our capsule inventory."}),e.jsx(X,{to:"/products",className:"inline-block bg-gradient-to-r from-orange-400 to-orange-600 text-white px-6 sm:px-8 py-2 sm:py-3 rounded-xl font-saiyan font-bold kamehameha-glow transition-all hover:scale-105 text-sm sm:text-base",children:"BACK TO PRODUCTS"})]})]})});const g=s.inStock||s.in_stock||s.stock>0,w=s.stock||0;return e.jsx("div",{className:`min-h-0 ${n.background} overflow-x-hidden`,children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 sm:py-8",children:[e.jsx(E,{}),e.jsxs("button",{onClick:()=>u(-1),className:`flex items-center space-x-2 transition-colors mb-4 sm:mb-6 font-saiyan text-sm sm:text-base ${a?"text-blue-400 hover:text-orange-400":"text-blue-600 hover:text-orange-600"}`,"aria-label":"Back to products",children:[e.jsx(Z,{}),e.jsx("span",{children:"BACK TO PRODUCTS"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12 mb-8 sm:mb-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[s&&e.jsx(oe,{src:P(s.gallery?.[o]??s.image,800),alt:s.name,className:"aspect-square shadow-xl",overlayText:s.name}),!g&&e.jsx("div",{className:"absolute top-3 sm:top-4 left-3 sm:left-4 bg-red-500 text-white px-3 sm:px-4 py-1 sm:py-2 rounded-full font-bold shadow-lg text-xs sm:text-sm",children:"OUT OF STOCK"}),(s.featured||s.is_featured)&&e.jsx("div",{className:"absolute top-3 sm:top-4 right-3 sm:right-4 bg-gradient-to-r from-orange-400 to-orange-600 text-white px-3 sm:px-4 py-1 sm:py-2 rounded-full font-bold kamehameha-glow text-xs sm:text-sm",children:"LEGENDARY ITEM"})]}),s.gallery&&s.gallery.length>1&&e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2","aria-label":"Product gallery thumbnails",children:s.gallery.map((r,i)=>e.jsx("button",{onClick:()=>t(i),className:`flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden border-2 transition-all ${o===i?"border-orange-500 scale-105":"border-gray-200 hover:border-blue-400"}`,"aria-label":`View image ${i+1}`,children:e.jsx("img",{src:P(r,80),alt:`${s.name} view ${i+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:l=>{l.target.src=`${J}/c_fill,w_80,h_80,g_center/v1759096629/d3_xdolmn.jpg`}})},i))})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold ${a?"bg-blue-900 text-blue-200":"bg-blue-100 text-blue-600"}`,children:s.category})}),e.jsx("h1",{className:`text-2xl sm:text-3xl lg:text-4xl font-bold font-saiyan ${n.text.primary}`,children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"text-yellow-400 text-lg sm:text-xl"}),e.jsxs("span",{className:`text-base sm:text-lg ${n.text.secondary}`,children:["Power Level: ",e.jsx("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:Number(s.powerLevel||s.power_level||0).toLocaleString()})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((r,i)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a?"bg-orange-900/50 text-orange-300":"bg-orange-100 text-orange-600"}`,children:r},i))}),e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[(s.originalPrice||s.original_price)&&e.jsx("span",{className:`text-xl sm:text-2xl line-through ${n.text.muted}`,children:e.jsx(T,{value:s.originalPrice||s.original_price})}),e.jsx("span",{className:"text-3xl sm:text-4xl font-bold font-saiyan text-orange-600 dark:text-orange-400",children:e.jsx(T,{value:s.price})}),(s.originalPrice||s.original_price)&&e.jsxs("span",{className:"bg-red-500 text-white px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-bold",children:["SAVE ",e.jsx(T,{value:parseFloat(s.originalPrice||s.original_price)-parseFloat(s.price)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${g?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`font-medium ${g?w<=9?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:g?w<=9?`Only ${w} left in stock!`:"In Stock":"Out of Stock"})]}),g&&e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("span",{className:`text-base sm:text-lg font-medium ${n.text.secondary}`,children:"Quantity:"}),e.jsxs("div",{className:`flex items-center border-2 rounded-lg ${a?"border-slate-600":"border-gray-300"}`,children:[e.jsx("button",{onClick:()=>A(-1),disabled:N<=1,className:`p-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${a?"hover:bg-slate-700":"hover:bg-gray-100"}`,"aria-label":"Decrease quantity",children:e.jsx(se,{className:a?"text-white":"text-gray-700"})}),e.jsx("span",{className:`px-3 sm:px-4 py-2 min-w-[2.5rem] sm:min-w-[3rem] text-center font-bold ${a?"text-white":"text-gray-900"}`,"aria-live":"polite",children:N}),e.jsx("button",{onClick:()=>A(1),disabled:N>=w,className:`p-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${a?"hover:bg-slate-700":"hover:bg-gray-100"}`,"aria-label":"Increase quantity",children:e.jsx(te,{className:a?"text-white":"text-gray-700"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsxs("button",{onClick:W,disabled:!g,className:`flex-1 flex items-center justify-center px-4 sm:px-8 py-3 sm:py-4 rounded-xl font-saiyan font-bold text-base sm:text-lg transition-all ${g?"bg-gradient-to-r from-orange-400 to-orange-600 text-white kamehameha-glow hover:scale-105 hover:shadow-xl":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"}`,"aria-label":g?"Add to cart":"Out of stock",children:[e.jsx(ae,{className:"mr-2 sm:mr-3"}),g?"ADD TO CAPSULE":"OUT OF STOCK"]}),e.jsx("button",{onClick:B,className:`px-4 sm:px-6 py-3 sm:py-4 rounded-xl border-2 transition-all flex items-center justify-center ${x(s.id)?"bg-red-500 text-white border-red-500":`${a?"bg-slate-700 text-white border-slate-600 hover:border-red-500 hover:text-red-500":"bg-white text-gray-700 border-gray-300 hover:border-red-500 hover:text-red-500"}`} ${f?"":"opacity-50 cursor-not-allowed"}`,disabled:!f,"aria-label":x(s.id)?"Remove from wishlist":"Add to wishlist",children:e.jsx(re,{className:"text-lg sm:text-xl"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4 pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600 dark:text-green-400",children:[e.jsx(le,{}),e.jsx("span",{className:"text-sm",children:"Battle Tested"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600 dark:text-blue-400",children:[e.jsx(ie,{}),e.jsx("span",{className:"text-sm",children:"Energy Efficient"})]})]})]})]}),e.jsxs("div",{className:`rounded-2xl shadow-lg overflow-hidden mb-8 sm:mb-12 ${n.card}`,children:[e.jsx("div",{className:`border-b ${a?"border-slate-700":"border-gray-200"}`,children:e.jsx("nav",{className:"flex overflow-x-auto","aria-label":"Product details tabs",children:[{id:"description",label:"Description"},{id:"specifications",label:"Specifications"},{id:"reviews",label:"Reviews"}].map(r=>e.jsx("button",{onClick:()=>_(r.id),className:`flex-shrink-0 px-4 sm:px-8 py-3 sm:py-4 font-saiyan font-bold transition-colors text-sm sm:text-base ${v===r.id?"bg-gradient-to-r from-orange-400 to-orange-600 text-white":`${a?"text-gray-300 hover:text-orange-400":"text-gray-600 hover:text-orange-600"}`}`,"aria-selected":v===r.id,"aria-controls":`tab-panel-${r.id}`,role:"tab",children:r.label},r.id))})}),e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[v==="description"&&e.jsx("div",{className:"prose max-w-none",id:"tab-panel-description",role:"tabpanel",children:e.jsx("p",{className:`text-base sm:text-lg leading-relaxed ${n.text.secondary}`,children:s.description})}),v==="specifications"&&s.specifications&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",id:"tab-panel-specifications",role:"tabpanel",children:Object.entries(s.specifications).map(([r,i])=>e.jsxs("div",{className:`flex justify-between items-center py-3 border-b ${a?"border-slate-700":"border-gray-200"}`,children:[e.jsxs("span",{className:`font-medium ${n.text.secondary}`,children:[r,":"]}),e.jsx("span",{className:"font-bold text-orange-600 dark:text-orange-400",children:i})]},r))}),v==="reviews"&&e.jsx("div",{id:"tab-panel-reviews",role:"tabpanel",children:e.jsx(de,{productId:s?.id})})]})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:`text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 font-saiyan ${n.text.primary}`,children:"RELATED CAPSULES"}),e.jsx("div",{className:"mobile-grid gap-4 sm:gap-6",children:b.map(r=>e.jsx(ne,{product:r,size:"medium"},r.id))})]})]})})}export{pe as default};
