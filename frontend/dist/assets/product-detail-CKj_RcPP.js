import{r as o,j as e,L as O,v as _,i as Q,w as A,d as W,x as z,u as G,f as V,y as Y,g as H,z as X,A as Z}from"./vendor_react-haPYDNah.js";import{u as F,a as k,P as y,b as E}from"./admin-D6GwwKla.js";import{P as w}from"./vendor-Bpvzf4S2.js";const I=o.createContext();function re({children:t}){const[l,c]=o.useState([]),{showSuccess:p,showInfo:f}=F();o.useEffect(()=>{const a=localStorage.getItem("capsule-cart");if(a)try{c(JSON.parse(a))}catch(x){console.error("Error loading cart from localStorage:",x)}},[]),o.useEffect(()=>{localStorage.setItem("capsule-cart",JSON.stringify(l))},[l]);const d=(a,x=1)=>{c(r=>r.find(m=>m.id===a.id)?(f(`ðŸ”„ Updated ${a.name} quantity in cart!`),r.map(m=>m.id===a.id?{...m,quantity:m.quantity+x}:m)):(p(`ðŸ’« ${a.name} added to cart!`),[...r,{...a,quantity:x}]))},g=a=>{c(x=>{const r=x.find(i=>i.id===a);return r&&f(`ðŸ—‘ï¸ ${r.name} removed from cart`),x.filter(i=>i.id!==a)})},s=(a,x)=>{if(x<=0){g(a);return}c(r=>r.map(i=>i.id===a?{...i,quantity:x}:i))},j=()=>{c([]),f("ðŸ§¹ Cart cleared")},b=()=>l.reduce((a,x)=>a+parseFloat(x.price)*x.quantity,0),u=()=>l.reduce((a,x)=>a+x.quantity,0);return e.jsx(I.Provider,{value:{cartItems:l,addToCart:d,removeFromCart:g,updateQuantity:s,clearCart:j,getCartTotal:b,getCartCount:u},children:t})}const L=()=>{const t=o.useContext(I);if(!t)throw new Error("useCart must be used within a CartProvider");return t},D=o.createContext();function ne({children:t}){const[l,c]=o.useState([]),[p,f]=o.useState(!1),{user:d}=k(),{showSuccess:g,showInfo:s}=F();o.useEffect(()=>{if(d){f(!0);const r=d.uid||d.id,i=localStorage.getItem(`capsule-wishlist-${r}`);if(i)try{const m=JSON.parse(i);c(m)}catch(m){console.error("Error loading wishlist from localStorage:",m),c([])}else c([]);f(!1)}else c([]),f(!1)},[d]),o.useEffect(()=>{if(d&&l.length>=0){const r=d.uid||d.id;localStorage.setItem(`capsule-wishlist-${r}`,JSON.stringify(l))}},[l,d]);const j=r=>d?(c(i=>i.find(v=>v.id===r.id)?(s(`ðŸ’– ${r.name} is already in your wishlist!`),i):(g(`ðŸ’– ${r.name} added to wishlist!`),[...i,r])),!0):(s("ðŸ” Please login to save items to your wishlist!"),!1),b=r=>{c(i=>{const m=i.find(v=>v.id===r);return m&&s(`ðŸ’” ${m.name} removed from wishlist`),i.filter(v=>v.id!==r)})},u=r=>l.some(i=>i.id===r),a=()=>l.length,x=()=>{c([]),s("ðŸ§¹ Wishlist cleared")};return e.jsx(D.Provider,{value:{wishlistItems:l,loading:p,addToWishlist:j,removeFromWishlist:b,isInWishlist:u,getWishlistCount:a,clearWishlist:x},children:t})}const R=()=>{const t=o.useContext(D);if(!t)throw new Error("useWishlist must be used within a WishlistProvider");return t};function S({src:t,alt:l,className:c="",overlayText:p=""}){const[f,d]=o.useState(!1);return o.useEffect(()=>{if(!t){d(!1);return}d(!1);const g=new Image;return g.src=t,g.onload=()=>d(!0),g.onerror=()=>d(!1),()=>{g.onload=null,g.onerror=null}},[t]),e.jsx("div",{className:`${c} bg-center bg-cover rounded-2xl overflow-hidden relative`,style:{backgroundImage:`url(${t})`},"aria-label":l,children:e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br from-[#3B4CCA] to-blue-600 items-center justify-center z-40 ${f?"hidden":"flex"}`,children:e.jsx("span",{className:"text-white font-bold font-saiyan text-center text-2xl px-4",children:p})})})}S.propTypes={src:w.string,alt:w.string,className:w.string,overlayText:w.string};function ee({product:t,size:l="medium"}){const{user:c}=k(),{addToCart:p}=L(),{addToWishlist:f,removeFromWishlist:d,isInWishlist:g}=R(),s=u=>{u.preventDefault(),u.stopPropagation(),(t.stock>0||t.inStock||t.in_stock)&&p(t)},j=u=>{u.preventDefault(),u.stopPropagation(),g(t.id)?d(t.id):f(t)},b={small:"h-32",medium:"h-48",large:"h-64"};return e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition-all hover:scale-105 border-2 border-transparent hover:border-orange-200 w-full max-w-sm mx-auto sm:max-w-none",children:[e.jsxs(O,{to:`/product/${t.slug}`,className:"block",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-full ${b[l]} flex items-center justify-center relative overflow-hidden`,children:e.jsx(S,{src:t.image,alt:t.name,className:`w-full ${b[l]}`,overlayText:t.name})}),(t.stock<=0||!t.inStock&&!t.in_stock)&&e.jsx("div",{className:"absolute top-3 left-3 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"OUT OF STOCK"}),(t.featured||t.is_featured)&&e.jsx("div",{className:"absolute top-3 right-3 bg-gradient-to-r from-orange-400 to-orange-600 text-white px-3 py-1 rounded-full text-xs font-bold kamehameha-glow",children:"LEGENDARY"}),e.jsx("button",{onClick:j,className:`absolute top-3 right-3 p-2 rounded-full transition-all ${t.featured||t.is_featured?"top-12":""} ${g(t.id)?"bg-red-500 text-white":"bg-white/80 text-gray-600 hover:bg-red-500 hover:text-white"} ${c?"hover:scale-110":"opacity-50"}`,"aria-label":g(t.id)?"Remove from wishlist":"Add to wishlist",children:e.jsx(_,{className:"text-sm"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsxs("div",{className:"bg-white/90 text-[#3B4CCA] px-4 py-2 rounded-lg font-saiyan font-bold flex items-center space-x-2",children:[e.jsx(Q,{}),e.jsx("span",{children:"VIEW DETAILS"})]})})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-xs font-semibold text-blue-600 bg-blue-100 px-2 py-1 rounded-full",children:t.category})}),e.jsx("h3",{className:`${l==="small"?"text-sm":"text-base sm:text-lg"} font-bold text-gray-800 mb-2 font-saiyan line-clamp-2`,children:t.name}),e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(A,{className:"text-yellow-400 mr-1"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:["Power Level: ",Number(t.powerLevel||t.power_level||0).toLocaleString()]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:t.tags.slice(0,2).map((u,a)=>e.jsx("span",{className:"text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded-full font-medium",children:u},a))}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[(t.originalPrice||t.original_price)&&e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 line-through mr-2",children:e.jsx(y,{value:t.originalPrice||t.original_price})}),e.jsx("span",{className:`${l==="small"?"text-base":"text-lg sm:text-xl"} font-bold text-orange-600 font-saiyan`,children:e.jsx(y,{value:t.price})})]}),t.stock<=5&&(t.inStock||t.in_stock||t.stock>0)&&e.jsxs("span",{className:"text-xs text-red-500 font-medium hidden sm:inline",children:["Only ",t.stock," left!"]})]})]})]}),e.jsx("div",{className:"px-3 sm:px-4 pb-3 sm:pb-4",children:e.jsxs("button",{onClick:s,disabled:!(t.inStock||t.in_stock||t.stock>0),className:`w-full flex items-center justify-center px-3 sm:px-4 py-2 sm:py-3 rounded-xl font-saiyan font-bold text-xs sm:text-sm transition-all touch-target ${t.inStock||t.in_stock||t.stock>0?"bg-gradient-to-r from-orange-400 to-orange-600 text-white kamehameha-glow hover:scale-105 hover:shadow-xl":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(W,{className:"mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:t.inStock||t.in_stock||t.stock>0?"ADD TO CAPSULE":"OUT OF STOCK"}),e.jsx("span",{className:"sm:hidden",children:t.inStock||t.in_stock||t.stock>0?"ADD":"OUT"})]})})]})}function se(){const{slug:t}=z(),l=G(),{user:c}=k(),{addToCart:p}=L(),{addToWishlist:f,removeFromWishlist:d,isInWishlist:g}=R(),[s,j]=o.useState(null),[b,u]=o.useState([]),[a,x]=o.useState(0),[r,i]=o.useState(!1),[m,v]=o.useState(1),[N,U]=o.useState("description"),[B,C]=o.useState(!0),[te,T]=o.useState(null);o.useEffect(()=>{(async()=>{try{C(!0),T(null);const n=await E(`/api/products/slug/${t}`);if(n.product){j(n.product);const M=((await E(`/api/products?category=${encodeURIComponent(n.product.category)}&limit=5`)).products||[]).filter(J=>J.id!==n.product.id).slice(0,4);u(M)}else l("/products")}catch(n){console.error("Error fetching product:",n),T("Product not found"),l("/products")}finally{C(!1)}})()},[t,l]),o.useEffect(()=>{if(!s)return;const h=s.gallery?.[a]||s.image;i(!1);const n=new Image;return n.src=h,n.onload=()=>i(!0),n.onerror=()=>i(!1),()=>{n.onload=null,n.onerror=null}},[s,a]);const K=()=>{s&&(s.inStock||s.in_stock||s.stock>0)&&p(s,m)},q=()=>{s&&(g(s.id)?d(s.id):f(s))},P=h=>{v(n=>Math.max(1,Math.min(s.stock,n+h)))};return B?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50 overflow-x-hidden",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-16 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-saiyan",children:"Loading product..."})]})})}):s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l(-1),className:"flex items-center space-x-2 text-blue-600 hover:text-orange-600 transition-colors mb-6 font-saiyan",children:[e.jsx(V,{}),e.jsx("span",{children:"BACK TO PRODUCTS"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 mb-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[s&&e.jsx(S,{src:s.gallery?.[a]||s.image,alt:s.name,className:"aspect-square shadow-xl",overlayText:s.name}),!(s.inStock||s.in_stock||s.stock>0)&&e.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-4 py-2 rounded-full font-bold shadow-lg",children:"OUT OF STOCK"}),(s.featured||s.is_featured)&&e.jsx("div",{className:"absolute top-4 right-4 bg-gradient-to-r from-orange-400 to-orange-600 text-white px-4 py-2 rounded-full font-bold kamehameha-glow",children:"LEGENDARY ITEM"})]}),s.gallery&&s.gallery.length>1&&e.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:s.gallery.map((h,n)=>e.jsx("button",{onClick:()=>x(n),className:`flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all ${a===n?"border-orange-500 scale-105":"border-gray-200 hover:border-blue-400"}`,children:e.jsx("img",{src:h,alt:`${s.name} view ${n+1}`,className:"w-full h-full object-cover",onError:$=>{$.target.src="/api/placeholder/80/80"}})},n))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-semibold",children:s.category})}),e.jsx("h1",{className:"text-4xl font-bold text-gray-800 font-saiyan",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"text-yellow-400 text-xl"}),e.jsxs("span",{className:"text-lg text-gray-700",children:["Power Level: ",e.jsx("span",{className:"font-bold text-orange-600",children:Number(s.powerLevel||s.power_level||0).toLocaleString()})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((h,n)=>e.jsx("span",{className:"bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-sm font-medium",children:h},n))}),e.jsxs("div",{className:"flex items-center space-x-4",children:[(s.originalPrice||s.original_price)&&e.jsx("span",{className:"text-2xl text-gray-400 line-through",children:e.jsx(y,{value:s.originalPrice||s.original_price})}),e.jsx("span",{className:"text-4xl font-bold text-orange-600 font-saiyan",children:e.jsx(y,{value:s.price})}),(s.originalPrice||s.original_price)&&e.jsxs("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold",children:["SAVE ",e.jsx(y,{value:parseFloat(s.originalPrice||s.original_price)-parseFloat(s.price)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.inStock||s.in_stock||s.stock>0?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`font-medium ${s.inStock||s.in_stock||s.stock>0?"text-green-600":"text-red-600"}`,children:s.inStock||s.in_stock||s.stock>0?s.stock<=5?`Only ${s.stock} left in stock!`:"In Stock":"Out of Stock"})]}),(s.inStock||s.in_stock||s.stock>0)&&e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Quantity:"}),e.jsxs("div",{className:"flex items-center border-2 border-gray-300 rounded-lg",children:[e.jsx("button",{onClick:()=>P(-1),disabled:m<=1,className:"p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Y,{})}),e.jsx("span",{className:"px-4 py-2 min-w-[3rem] text-center font-bold",children:m}),e.jsx("button",{onClick:()=>P(1),disabled:m>=s.stock,className:"p-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(H,{})})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:K,disabled:!(s.inStock||s.in_stock||s.stock>0),className:`flex-1 flex items-center justify-center px-8 py-4 rounded-xl font-saiyan font-bold text-lg transition-all ${s.inStock||s.in_stock||s.stock>0?"bg-gradient-to-r from-orange-400 to-orange-600 text-white kamehameha-glow hover:scale-105 hover:shadow-xl":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx(W,{className:"mr-3"}),s.inStock||s.in_stock||s.stock>0?"ADD TO CAPSULE":"OUT OF STOCK"]}),e.jsx("button",{onClick:q,className:`px-6 py-4 rounded-xl border-2 transition-all ${g(s.id)?"bg-red-500 text-white border-red-500":"bg-white text-gray-700 border-gray-300 hover:border-red-500 hover:text-red-500"} ${c?"":"opacity-50 cursor-not-allowed"}`,disabled:!c,children:e.jsx(_,{className:"text-xl"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(X,{}),e.jsx("span",{className:"text-sm",children:"Battle Tested"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx(Z,{}),e.jsx("span",{className:"text-sm",children:"Energy Efficient"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden mb-12",children:[e.jsx("div",{className:"border-b",children:e.jsx("nav",{className:"flex",children:[{id:"description",label:"Description"},{id:"specifications",label:"Specifications"},{id:"reviews",label:"Reviews"}].map(h=>e.jsx("button",{onClick:()=>U(h.id),className:`px-8 py-4 font-saiyan font-bold transition-colors ${N===h.id?"bg-gradient-to-r from-orange-400 to-orange-600 text-white":"text-gray-600 hover:text-orange-600"}`,children:h.label},h.id))})}),e.jsxs("div",{className:"p-8",children:[N==="description"&&e.jsx("div",{className:"prose max-w-none",children:e.jsx("p",{className:"text-lg text-gray-700 leading-relaxed",children:s.description})}),N==="specifications"&&s.specifications&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(s.specifications).map(([h,n])=>e.jsxs("div",{className:"flex justify-between items-center py-3 border-b border-gray-200",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[h,":"]}),e.jsx("span",{className:"font-bold text-orange-600",children:n})]},h))}),N==="reviews"&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600 text-lg",children:"Reviews coming soon! Battle-test this item and share your experience."})})]})]}),b.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 font-saiyan mb-8",children:"RELATED CAPSULES"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:b.map(h=>e.jsx(ee,{product:h,size:"medium"},h.id))})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 mb-4 font-saiyan",children:"PRODUCT NOT FOUND"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"The product you're looking for doesn't exist in our capsule inventory."}),e.jsx(O,{to:"/products",className:"inline-block bg-gradient-to-r from-orange-400 to-orange-600 text-white px-8 py-3 rounded-xl font-saiyan font-bold kamehameha-glow transition-all hover:scale-105",children:"BACK TO PRODUCTS"})]})})})}const oe=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{re as C,ee as P,ne as W,R as a,oe as b,L as u};
