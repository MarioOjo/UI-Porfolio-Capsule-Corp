import{c as re,K as se,o as le,r as n,h as g,a as e,j as a,M as ne,au as L,av as P,V as I,I as ie,a8 as M,aw as ce,ax as oe}from"./index-69bf95fe.js";import{P as A}from"./Price-711279c4.js";function he(){const{user:r}=re(),b=se(),{showSuccess:y,showError:o}=le(),[d,F]=n.useState([]),[$,H]=n.useState(null),[m,U]=n.useState(""),[N,V]=n.useState("all"),[v,G]=n.useState("all"),[J,T]=n.useState(!0),[_,E]=n.useState(!1),[l,O]=n.useState(null),[q,w]=n.useState(!1),[u,k]=n.useState({tracking_number:"",carrier:""}),[j,R]=n.useState(""),[C,z]=n.useState(!0),h=n.useCallback(async(t=!0)=>{try{t?T(!0):E(!0);const s={};if(N!=="all"&&(s.status=N),m&&(s.search=m),v!=="all"){const c=new Date;let f;switch(v){case"today":f=new Date(c.setHours(0,0,0,0));break;case"week":f=new Date(c.setDate(c.getDate()-7));break;case"month":f=new Date(c.setMonth(c.getMonth()-1));break;default:break}f&&(s.date_from=f.toISOString().split("T")[0])}const i=new URLSearchParams(s).toString(),x=await g(`/api/orders?${i}`,{headers:{"x-user-email":r==null?void 0:r.email}});x.orders&&F(x.orders)}catch(s){console.error("Error fetching orders:",s),o("Failed to fetch orders")}finally{T(!1),E(!1)}},[N,m,v,r,o]),p=n.useCallback(async()=>{try{const t=await g("/api/orders/statistics",{headers:{"x-user-email":r==null?void 0:r.email}});t.statistics&&H(t.statistics)}catch(t){console.error("Error fetching statistics:",t)}},[r]);n.useEffect(()=>{r&&(h(),p())},[r,h,p]),n.useEffect(()=>{if(!C)return;const t=setInterval(()=>{h(!1),p()},3e4);return()=>clearInterval(t)},[C,h,p]),n.useEffect(()=>{var s;if(!r){b("/auth");return}if(!(((s=r.email)==null?void 0:s.includes("admin"))||r.role==="admin"||r.email==="mario@capsulecorp.com")){b("/");return}},[r,b]);const D=d.filter(t=>{var i,x,c;return((i=t.order_number)==null?void 0:i.toLowerCase().includes(m.toLowerCase()))||((x=t.customer_name)==null?void 0:x.toLowerCase().includes(m.toLowerCase()))||((c=t.customer_email)==null?void 0:c.toLowerCase().includes(m.toLowerCase()))}),B=t=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",K=async(t,s)=>{try{await g(`/api/orders/${t}/status`,{method:"PATCH",headers:{"x-user-email":r==null?void 0:r.email,"x-user-id":r==null?void 0:r.id},body:JSON.stringify({status:s})}),F(d.map(i=>i.id===t?{...i,status:s}:i)),y(`Order status updated to ${s}`),p()}catch(i){console.error("Error updating status:",i),o("Failed to update order status")}},Q=async t=>{try{const s=await g(`/api/orders/${t.id}`,{headers:{"x-user-email":r==null?void 0:r.email}});s.order&&(O(s.order),k({tracking_number:s.order.tracking_number||"",carrier:s.order.carrier||""}),R(s.order.admin_notes||""),w(!0))}catch(s){console.error("Error fetching order details:",s),o("Failed to load order details")}},W=async()=>{if(!l||!u.tracking_number){o("Please enter tracking number");return}try{await g(`/api/orders/${l.id}/tracking`,{method:"PATCH",headers:{"x-user-email":r==null?void 0:r.email},body:JSON.stringify(u)}),y("Tracking information updated"),h(!1),w(!1)}catch(t){console.error("Error updating tracking:",t),o("Failed to update tracking")}},X=async()=>{if(l)try{await g(`/api/orders/${l.id}/notes`,{method:"PATCH",headers:{"x-user-email":r==null?void 0:r.email},body:JSON.stringify({notes:j})}),y("Admin notes updated"),h(!1)}catch(t){console.error("Error updating notes:",t),o("Failed to update notes")}},Y=()=>{h(!1),p(),y("Orders refreshed")},S=$||{total_orders:d.length,total_revenue:d.reduce((t,s)=>t+parseFloat(s.total||0),0),pending_orders:d.filter(t=>t.status==="pending").length,delivered_orders:d.filter(t=>t.status==="delivered").length},Z=Number(S.total_orders)||0,ee=Number(S.total_revenue)||0,te=Number(S.pending_orders)||0,ae=Number(S.delivered_orders)||0;return!r||J?e("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50 flex items-center justify-center",children:a("div",{className:"text-center",children:[e("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"}),e("p",{className:"text-gray-600 font-saiyan",children:"LOADING ORDERS..."})]})}):a("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50",children:[e("header",{className:"bg-gradient-to-r from-[#3B4CCA] to-blue-600 shadow-lg",children:e("div",{className:"max-w-7xl mx-auto px-4 py-4",children:a("div",{className:"flex items-center justify-between",children:[a("div",{className:"flex items-center space-x-4",children:[e("button",{onClick:()=>b("/admin"),className:"text-white hover:text-[#FFD700] transition-colors",children:e(ne,{className:"text-xl"})}),e("h1",{className:"text-2xl font-bold text-white font-saiyan",children:"ORDER MANAGEMENT"}),_&&e(L,{className:"text-white animate-spin"})]}),a("div",{className:"flex items-center space-x-4",children:[a("label",{className:"flex items-center space-x-2 text-white text-sm",children:[e("input",{type:"checkbox",checked:C,onChange:t=>z(t.target.checked),className:"rounded"}),e("span",{children:"Auto-refresh (30s)"})]}),a("button",{onClick:Y,disabled:_,className:"bg-white text-blue-600 px-4 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center space-x-2 disabled:opacity-50",children:[e(L,{className:_?"animate-spin":""}),e("span",{children:"REFRESH"})]}),a("button",{onClick:()=>console.log("Export orders"),className:"bg-gradient-to-r from-orange-400 to-orange-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center space-x-2",children:[e(P,{}),e("span",{children:"EXPORT"})]})]})]})})}),a("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[a("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),e("p",{className:"text-3xl font-bold text-blue-600 font-saiyan",children:Z})]}),e("div",{className:"bg-blue-100 p-3 rounded-full",children:e(I,{className:"text-blue-600 text-xl"})})]})}),e("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),a("p",{className:"text-3xl font-bold text-green-600 font-saiyan",children:["$",ee.toLocaleString()]})]}),e("div",{className:"bg-green-100 p-3 rounded-full",children:e("span",{className:"text-green-600 text-xl",children:"$"})})]})}),e("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-gray-600",children:"Pending Orders"}),e("p",{className:"text-3xl font-bold text-yellow-600 font-saiyan",children:te})]}),e("div",{className:"bg-yellow-100 p-3 rounded-full",children:e("span",{className:"text-yellow-600 text-xl",children:"⏳"})})]})}),e("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:a("div",{className:"flex items-center justify-between",children:[a("div",{children:[e("p",{className:"text-sm font-medium text-gray-600",children:"Delivered Orders"}),e("p",{className:"text-3xl font-bold text-green-600 font-saiyan",children:ae})]}),e("div",{className:"bg-green-100 p-3 rounded-full",children:e("span",{className:"text-green-600 text-xl",children:"✓"})})]})})]}),a("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[a("div",{className:"flex flex-col lg:flex-row gap-4",children:[e("div",{className:"flex-1",children:a("div",{className:"relative",children:[e(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e("input",{type:"text",placeholder:"Search by order ID, customer name, or email...",value:m,onChange:t=>U(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),a("select",{value:N,onChange:t=>V(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all",children:"All Statuses"}),e("option",{value:"pending",children:"Pending"}),e("option",{value:"processing",children:"Processing"}),e("option",{value:"shipped",children:"Shipped"}),e("option",{value:"delivered",children:"Delivered"}),e("option",{value:"cancelled",children:"Cancelled"})]}),a("select",{value:v,onChange:t=>G(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e("option",{value:"all",children:"All Time"}),e("option",{value:"today",children:"Today"}),e("option",{value:"week",children:"This Week"}),e("option",{value:"month",children:"This Month"})]})]}),a("div",{className:"mt-4 text-sm text-gray-600",children:["Showing ",D.length," of ",d.length," orders"]})]}),e("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e("div",{className:"overflow-x-auto",children:a("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 border-b",children:a("tr",{children:[e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(t=>a("tr",{className:"hover:bg-gray-50",children:[a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900 font-saiyan",children:t.order_number}),e("div",{className:"text-sm text-gray-500",children:t.payment_method})]}),a("td",{className:"px-6 py-4 whitespace-nowrap",children:[e("div",{className:"text-sm font-medium text-gray-900",children:t.customer_name}),e("div",{className:"text-sm text-gray-500",children:t.customer_email})]}),a("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[new Date(t.created_at).toLocaleDateString(),e("div",{className:"text-xs text-gray-500",children:new Date(t.created_at).toLocaleTimeString()})]}),e("td",{className:"px-6 py-4 whitespace-nowrap",children:a("select",{value:t.status,onChange:s=>K(t.id,s.target.value),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B(t.status)} border-none focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer`,children:[e("option",{value:"pending",children:"Pending"}),e("option",{value:"processing",children:"Processing"}),e("option",{value:"shipped",children:"Shipped"}),e("option",{value:"delivered",children:"Delivered"}),e("option",{value:"cancelled",children:"Cancelled"})]})}),a("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.item_count||0," items"]}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-saiyan",children:e(A,{value:parseFloat(t.total||0)})}),e("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a("div",{className:"flex items-center space-x-2",children:[e("button",{onClick:()=>Q(t),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:e(I,{})}),e("button",{onClick:()=>{O(t),k({tracking_number:t.tracking_number||"",carrier:t.carrier||""}),w(!0)},className:"text-purple-600 hover:text-purple-900",title:"Add Tracking",children:e(M,{})}),e("button",{onClick:()=>console.log("Download invoice:",t.order_number),className:"text-green-600 hover:text-green-900",title:"Download Invoice",children:e(P,{})})]})})]},t.id))})]})})}),D.length===0&&a("div",{className:"text-center py-12",children:[e(ce,{className:"text-6xl text-gray-300 mx-auto mb-4"}),e("h3",{className:"text-xl font-bold text-gray-800 font-saiyan mb-2",children:"No orders found"}),e("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria"})]})]}),q&&l&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a("div",{className:"bg-gradient-to-r from-[#3B4CCA] to-blue-600 p-6 rounded-t-2xl",children:[a("div",{className:"flex items-center justify-between",children:[e("h2",{className:"text-2xl font-bold text-white font-saiyan",children:"ORDER DETAILS"}),e("button",{onClick:()=>w(!1),className:"text-white hover:text-[#FFD700] transition-colors text-2xl",children:"×"})]}),e("p",{className:"text-white mt-2",children:l.order_number})]}),a("div",{className:"p-6 space-y-6",children:[a("div",{children:[e("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Customer Information"}),a("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[a("p",{children:[e("span",{className:"font-semibold",children:"Name:"})," ",l.customer_name]}),a("p",{children:[e("span",{className:"font-semibold",children:"Email:"})," ",l.customer_email]}),a("p",{children:[e("span",{className:"font-semibold",children:"Phone:"})," ",l.customer_phone||"N/A"]})]})]}),a("div",{children:[e("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Shipping Address"}),a("div",{className:"bg-gray-50 rounded-lg p-4",children:[e("p",{children:l.shipping_address_line1}),l.shipping_address_line2&&e("p",{children:l.shipping_address_line2}),a("p",{children:[l.shipping_city,", ",l.shipping_state," ",l.shipping_zip]}),e("p",{children:l.shipping_country})]})]}),a("div",{children:[e("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Tracking Information"}),a("div",{className:"space-y-3",children:[a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking Number"}),e("input",{type:"text",value:u.tracking_number,onChange:t=>k({...u,tracking_number:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter tracking number"})]}),a("div",{children:[e("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Carrier"}),e("input",{type:"text",value:u.carrier,onChange:t=>k({...u,carrier:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., UPS, FedEx, DHL"})]}),a("button",{onClick:W,className:"w-full bg-gradient-to-r from-purple-400 to-purple-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center justify-center space-x-2",children:[e(M,{}),e("span",{children:"UPDATE TRACKING"})]})]})]}),a("div",{children:[e("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Admin Notes"}),e("textarea",{value:j,onChange:t=>R(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-32",placeholder:"Add internal notes about this order..."}),a("button",{onClick:X,className:"mt-2 w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center justify-center space-x-2",children:[e(oe,{}),e("span",{children:"SAVE NOTES"})]})]}),l.items&&l.items.length>0&&a("div",{children:[e("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Order Items"}),e("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:l.items.map((t,s)=>a("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2",children:[a("div",{className:"flex items-center space-x-3",children:[t.product_image&&e("img",{src:t.product_image,alt:t.product_name,className:"w-12 h-12 object-cover rounded"}),a("div",{children:[e("p",{className:"font-semibold",children:t.product_name}),a("p",{className:"text-sm text-gray-600",children:["Qty: ",t.quantity]})]})]}),e("p",{className:"font-bold",children:e(A,{value:parseFloat(t.subtotal)})})]},s))})]}),e("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4",children:a("div",{className:"flex justify-between items-center",children:[e("span",{className:"text-lg font-bold font-saiyan",children:"TOTAL:"}),e("span",{className:"text-2xl font-bold text-orange-600 font-saiyan",children:e(A,{value:parseFloat(l.total)})})]})})]})]})})]})}export{he as default};
