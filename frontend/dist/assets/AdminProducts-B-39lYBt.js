import{l as G,o as M,r as i,A as _,j as e,a2 as V,U as F}from"./index-C_rhaFlX.js";function H(){const{user:B}=G();M();const[$,P]=i.useState([]),[z,J]=i.useState(!0),[O,b]=i.useState(!1),[L,A]=i.useState(!1),[E,U]=i.useState(null),[K,W]=i.useState(""),{showSuccess:h,showError:T}=_(),R=async t=>{try{const a=new FormData;if(a.append("name",t.name),a.append("description",t.description),a.append("price",String(t.price)),a.append("category",t.category),a.append("stock",String(t.stock)),a.append("power_level",String(t.powerLevel||0)),a.append("in_stock",t.inStock?"1":"0"),a.append("gallery",JSON.stringify(t.imageUrls||[])),t.imageFiles&&t.imageFiles.length)for(const n of t.imageFiles)a.append("images",n);const r=await F("/api/products",{method:"POST",body:a});r?.product?(P(n=>[r.product,...n]),h("Product created successfully")):h("Product created")}catch(a){throw T(a.message||"Failed to create product"),console.error("Create product error",a),a}},I=async t=>{try{const a=new FormData;if(a.append("name",t.name),a.append("description",t.description),a.append("price",String(t.price)),a.append("category",t.category),a.append("stock",String(t.stock)),a.append("power_level",String(t.powerLevel||0)),a.append("in_stock",t.inStock?"1":"0"),a.append("gallery",JSON.stringify(t.imageUrls||t.gallery||[])),t.imageFiles&&t.imageFiles.length)for(const n of t.imageFiles)a.append("images",n);const r=await F(`/api/products/${t.id}`,{method:"PUT",body:a});r?.product?(P(n=>n.map(m=>m.id===r.product.id?r.product:m)),h("Product updated successfully")):h("Product updated")}catch(a){throw T(a.message||"Failed to update product"),console.error("Update product error",a),a}},D=({onSave:t,onCancel:a})=>{const[r,n]=i.useState({name:"",description:"",price:"",category:"Battle Gear",stock:"",powerLevel:"",inStock:!0}),[m,u]=i.useState([]),[x,v]=i.useState(""),[f,p]=i.useState([]),[d,y]=i.useState({}),j=s=>{s.preventDefault(),s.dataTransfer.files&&s.dataTransfer.files.length&&u(l=>[...l,...Array.from(s.dataTransfer.files)])},N=s=>{s.preventDefault()},w=s=>{s.preventDefault();const l={};r.name.trim()||(l.name="Product name is required."),r.description.trim()||(l.description="Description is required."),(!r.price||isNaN(r.price)||Number(r.price)<=0)&&(l.price="Valid price required."),(!r.stock||isNaN(r.stock)||Number(r.stock)<0)&&(l.stock="Valid stock required."),r.category||(l.category="Category required."),m.length===0&&f.length===0&&(l.images="At least one image is required."),y(l),!(Object.keys(l).length>0)&&t({...r,price:parseFloat(r.price),stock:parseInt(r.stock),powerLevel:parseInt(r.powerLevel)||0,imageFiles:m,imageUrls:f})},g=(s,l)=>{n(S=>({...S,[s]:l}))},k=()=>{x.trim()&&(p(s=>[...s,x.trim()]),v(""))},o=s=>{p(l=>l.filter((S,C)=>C!==s))},c=s=>{u(l=>l.filter((S,C)=>C!==s))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true",tabIndex:-1,"aria-labelledby":"add-product-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onDrop:j,onDragOver:N,children:[e.jsx("h3",{id:"add-product-title",className:"text-2xl font-bold text-gray-800 font-saiyan mb-6",children:"ADD NEW PRODUCT"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"PRODUCT NAME"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>g("name",s.target.value),placeholder:"Enter product name",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan"}),d.name&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"DESCRIPTION"}),e.jsx("textarea",{value:r.description,onChange:s=>g("description",s.target.value),placeholder:"Enter product description",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-24 resize-none"}),d.description&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"PRICE ($)"}),e.jsx("input",{type:"number",step:"0.01",value:r.price,onChange:s=>g("price",s.target.value),placeholder:"0.00",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan"}),d.price&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.price})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"STOCK"}),e.jsx("input",{type:"number",value:r.stock,onChange:s=>g("stock",s.target.value),placeholder:"0",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan"}),d.stock&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.stock})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"CATEGORY"}),e.jsxs("select",{value:r.category,onChange:s=>g("category",s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan",children:[e.jsx("option",{value:"Battle Gear",children:"Battle Gear"}),e.jsx("option",{value:"Training",children:"Training"}),e.jsx("option",{value:"Technology",children:"Technology"}),e.jsx("option",{value:"Capsules",children:"Capsules"})]}),d.category&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"POWER LEVEL"}),e.jsx("input",{type:"number",value:r.powerLevel,onChange:s=>g("powerLevel",s.target.value),placeholder:"9000",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"inStockAdd",checked:r.inStock,onChange:s=>g("inStock",s.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"inStockAdd",className:"text-sm font-saiyan text-gray-700",children:"IN STOCK"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"IMAGE (file upload or drag-and-drop) — you can select multiple"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:s=>u(l=>[...l,...Array.from(s.target.files||[])]),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Or paste an image URL below and click "Add to Gallery". You can also drag-and-drop images into this modal.'}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("input",{type:"text",value:x,onChange:s=>v(s.target.value),placeholder:"https://...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Add to Gallery"})]}),d.images&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:d.images}),m.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-saiyan text-gray-700 mb-2",children:"Uploaded Files:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((s,l)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`preview-${l}`,className:"w-20 h-20 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>c(l),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",title:"Remove",children:"×"})]},l))})]}),f.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-saiyan text-gray-700 mb-2",children:"Gallery URLs:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((s,l)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:`gallery-${l}`,className:"w-20 h-20 object-cover rounded-lg border"}),e.jsx("button",{type:"button",onClick:()=>o(l),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm",title:"Remove",children:"×"})]},l))})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:a,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-saiyan font-bold hover:bg-gray-400 transition-colors",children:"CANCEL"}),e.jsx("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-orange-400 to-orange-600 text-white py-3 px-4 rounded-lg font-saiyan font-bold hover:scale-105 transition-all",children:"ADD PRODUCT"})]})]})]})})},q=({product:t,onSave:a,onCancel:r})=>{const[n,m]=i.useState({name:t?.name||"",description:t?.description||"",price:t?.price||"",category:t?.category||"Battle Gear",stock:t?.stock||"",powerLevel:t?.powerLevel||t?.power_level||"",inStock:t?.inStock!==void 0?t.inStock:t?.in_stock||!0}),[u,x]=i.useState([]),[v,f]=i.useState(""),[p,d]=i.useState(t?.gallery||[]),[y,j]=i.useState({}),N=o=>{o.preventDefault(),o.dataTransfer.files&&o.dataTransfer.files.length&&x(c=>[...c,...Array.from(o.dataTransfer.files)])},w=o=>{o.preventDefault()},g=o=>{o.preventDefault();const c={};n.name.trim()||(c.name="Product name is required."),n.description.trim()||(c.description="Description is required."),(!n.price||isNaN(n.price)||Number(n.price)<=0)&&(c.price="Valid price required."),(!n.stock||isNaN(n.stock)||Number(n.stock)<0)&&(c.stock="Valid stock required."),n.category||(c.category="Category required."),u.length===0&&p.length===0&&(c.images="At least one image is required."),j(c),!(Object.keys(c).length>0)&&a({...t,...n,price:parseFloat(n.price),stock:parseInt(n.stock),powerLevel:parseInt(n.powerLevel)||0,imageFiles:u,imageUrls:p,gallery:p})},k=(o,c)=>{m(s=>({...s,[o]:c}))};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",role:"dialog","aria-modal":"true",tabIndex:-1,"aria-labelledby":"edit-product-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onDrop:N,onDragOver:w,children:[e.jsx("h3",{id:"edit-product-title",className:"text-2xl font-bold text-gray-800 font-saiyan mb-6",children:"EDIT PRODUCT"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-saiyan text-gray-700 mb-2",children:"PRODUCT NAME"}),e.jsx("input",{type:"text",value:n.name,onChange:o=>k("name",o.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-saiyan"}),y.name&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:y.name})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-saiyan font-bold hover:bg-gray-400 transition-colors",children:"CANCEL"}),e.jsx("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-orange-400 to-orange-600 text-white py-3 px-4 rounded-lg font-saiyan font-bold hover:scale-105 transition-all",children:"UPDATE PRODUCT"})]})]})]})}):null};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 font-saiyan",children:"Admin Products"}),e.jsxs("button",{onClick:()=>b(!0),className:"bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-600",children:[e.jsx(V,{})," Add Product"]})]}),O&&e.jsx(D,{onSave:async t=>{try{await R(t),b(!1)}catch{}},onCancel:()=>b(!1)}),L&&E&&e.jsx(q,{product:E,onSave:async t=>{try{await I(t),A(!1),U(null)}catch{}},onCancel:()=>{A(!1),U(null)}})]})})}export{H as default};
