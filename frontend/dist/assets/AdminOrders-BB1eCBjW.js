import{b as te,c as ae,o as re,r as l,f as u,j as e,K as le,az as R,aA as L,V as P,I as ne,P as _,aa as I,aB as ie,aC as ce}from"./index-D_Xgmlfr.js";function de(){const{user:r}=te(),g=ae(),{showSuccess:f,showError:n}=re(),[i,C]=l.useState([]),[$,M]=l.useState(null),[c,H]=l.useState(""),[j,U]=l.useState("all"),[b,V]=l.useState("all"),[z,A]=l.useState(!0),[w,D]=l.useState(!1),[a,T]=l.useState(null),[B,y]=l.useState(!1),[x,N]=l.useState({tracking_number:"",carrier:""}),[E,O]=l.useState(""),[k,G]=l.useState(!0),o=l.useCallback(async(s=!0)=>{try{s?A(!0):D(!0);const t={};if(j!=="all"&&(t.status=j),c&&(t.search=c),b!=="all"){const h=new Date;let p;switch(b){case"today":p=new Date(h.setHours(0,0,0,0));break;case"week":p=new Date(h.setDate(h.getDate()-7));break;case"month":p=new Date(h.setMonth(h.getMonth()-1));break;default:break}p&&(t.date_from=p.toISOString().split("T")[0])}const d=new URLSearchParams(t).toString(),F=await u(`/api/orders?${d}`,{headers:{"x-user-email":r?.email}});F.orders&&C(F.orders)}catch(t){console.error("Error fetching orders:",t),n("Failed to fetch orders")}finally{A(!1),D(!1)}},[j,c,b,r,n]),m=l.useCallback(async()=>{try{const s=await u("/api/orders/statistics",{headers:{"x-user-email":r?.email}});s.statistics&&M(s.statistics)}catch(s){console.error("Error fetching statistics:",s)}},[r]);l.useEffect(()=>{r&&(o(),m())},[r,o,m]),l.useEffect(()=>{if(!k)return;const s=setInterval(()=>{o(!1),m()},3e4);return()=>clearInterval(s)},[k,o,m]),l.useEffect(()=>{if(!r){g("/auth");return}if(!(r.email?.includes("admin")||r.role==="admin"||r.email==="mario@capsulecorp.com")){g("/");return}},[r,g]);const S=i.filter(s=>s.order_number?.toLowerCase().includes(c.toLowerCase())||s.customer_name?.toLowerCase().includes(c.toLowerCase())||s.customer_email?.toLowerCase().includes(c.toLowerCase())),J=s=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",q=async(s,t)=>{try{await u(`/api/orders/${s}/status`,{method:"PATCH",headers:{"x-user-email":r?.email,"x-user-id":r?.id},body:JSON.stringify({status:t})}),C(i.map(d=>d.id===s?{...d,status:t}:d)),f(`Order status updated to ${t}`),m()}catch(d){console.error("Error updating status:",d),n("Failed to update order status")}},K=async s=>{try{const t=await u(`/api/orders/${s.id}`,{headers:{"x-user-email":r?.email}});t.order&&(T(t.order),N({tracking_number:t.order.tracking_number||"",carrier:t.order.carrier||""}),O(t.order.admin_notes||""),y(!0))}catch(t){console.error("Error fetching order details:",t),n("Failed to load order details")}},Q=async()=>{if(!a||!x.tracking_number){n("Please enter tracking number");return}try{await u(`/api/orders/${a.id}/tracking`,{method:"PATCH",headers:{"x-user-email":r?.email},body:JSON.stringify(x)}),f("Tracking information updated"),o(!1),y(!1)}catch(s){console.error("Error updating tracking:",s),n("Failed to update tracking")}},W=async()=>{if(a)try{await u(`/api/orders/${a.id}/notes`,{method:"PATCH",headers:{"x-user-email":r?.email},body:JSON.stringify({notes:E})}),f("Admin notes updated"),o(!1)}catch(s){console.error("Error updating notes:",s),n("Failed to update notes")}},X=()=>{o(!1),m(),f("Orders refreshed")},v=$||{total_orders:i.length,total_revenue:i.reduce((s,t)=>s+parseFloat(t.total||0),0),pending_orders:i.filter(s=>s.status==="pending").length,delivered_orders:i.filter(s=>s.status==="delivered").length},Y=Number(v.total_orders)||0,Z=Number(v.total_revenue)||0,ee=Number(v.pending_orders)||0,se=Number(v.delivered_orders)||0;return!r||z?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-saiyan",children:"LOADING ORDERS..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50",children:[e.jsx("header",{className:"bg-gradient-to-r from-[#3B4CCA] to-blue-600 shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>g("/admin"),className:"text-white hover:text-capsule-accent transition-colors",children:e.jsx(le,{className:"text-xl"})}),e.jsx("h1",{className:"text-2xl font-bold text-white font-saiyan",children:"ORDER MANAGEMENT"}),w&&e.jsx(R,{className:"text-white animate-spin"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 text-white text-sm",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>G(s.target.checked),className:"rounded"}),e.jsx("span",{children:"Auto-refresh (30s)"})]}),e.jsxs("button",{onClick:X,disabled:w,className:"bg-white text-blue-600 px-4 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center space-x-2 disabled:opacity-50",children:[e.jsx(R,{className:w?"animate-spin":""}),e.jsx("span",{children:"REFRESH"})]}),e.jsxs("button",{onClick:()=>console.log("Export orders"),className:"bg-gradient-to-r from-orange-400 to-orange-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center space-x-2",children:[e.jsx(L,{}),e.jsx("span",{children:"EXPORT"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 font-saiyan",children:Y})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(P,{className:"text-blue-600 text-xl"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600 font-saiyan",children:["$",Z.toLocaleString()]})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx("span",{className:"text-green-600 text-xl",children:"$"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Orders"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 font-saiyan",children:ee})]}),e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx("span",{className:"text-yellow-600 text-xl",children:"⏳"})})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Delivered Orders"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 font-saiyan",children:se})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx("span",{className:"text-green-600 text-xl",children:"✓"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, or email...",value:c,onChange:s=>H(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsxs("select",{value:j,onChange:s=>U(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:b,onChange:s=>V(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Showing ",S.length," of ",i.length," orders"]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 font-saiyan",children:s.order_number}),e.jsx("div",{className:"text-sm text-gray-500",children:s.payment_method})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.customer_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.customer_email})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[new Date(s.created_at).toLocaleDateString(),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:s.status,onChange:t=>q(s.id,t.target.value),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${J(s.status)} border-none focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[s.item_count||0," items"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-saiyan",children:e.jsx(_,{value:parseFloat(s.total||0)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>K(s),className:"text-blue-600 hover:text-blue-900",title:"View Details",children:e.jsx(P,{})}),e.jsx("button",{onClick:()=>{T(s),N({tracking_number:s.tracking_number||"",carrier:s.carrier||""}),y(!0)},className:"text-purple-600 hover:text-purple-900",title:"Add Tracking",children:e.jsx(I,{})}),e.jsx("button",{onClick:()=>console.log("Download invoice:",s.order_number),className:"text-green-600 hover:text-green-900",title:"Download Invoice",children:e.jsx(L,{})})]})})]},s.id))})]})})}),S.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"text-6xl text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 font-saiyan mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria"})]})]}),B&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#3B4CCA] to-blue-600 p-6 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white font-saiyan",children:"ORDER DETAILS"}),e.jsx("button",{onClick:()=>y(!1),className:"text-white hover:text-capsule-accent transition-colors text-2xl",children:"×"})]}),e.jsx("p",{className:"text-white mt-2",children:a.order_number})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Customer Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",a.customer_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Email:"})," ",a.customer_email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",a.customer_phone||"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Shipping Address"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{children:a.shipping_address_line1}),a.shipping_address_line2&&e.jsx("p",{children:a.shipping_address_line2}),e.jsxs("p",{children:[a.shipping_city,", ",a.shipping_state," ",a.shipping_zip]}),e.jsx("p",{children:a.shipping_country})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Tracking Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tracking Number"}),e.jsx("input",{type:"text",value:x.tracking_number,onChange:s=>N({...x,tracking_number:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter tracking number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Carrier"}),e.jsx("input",{type:"text",value:x.carrier,onChange:s=>N({...x,carrier:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., UPS, FedEx, DHL"})]}),e.jsxs("button",{onClick:Q,className:"w-full bg-gradient-to-r from-purple-400 to-purple-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center justify-center space-x-2",children:[e.jsx(I,{}),e.jsx("span",{children:"UPDATE TRACKING"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Admin Notes"}),e.jsx("textarea",{value:E,onChange:s=>O(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-32",placeholder:"Add internal notes about this order..."}),e.jsxs("button",{onClick:W,className:"mt-2 w-full bg-gradient-to-r from-blue-400 to-blue-600 text-white px-6 py-2 rounded-lg font-saiyan font-bold hover:scale-105 transition-all flex items-center justify-center space-x-2",children:[e.jsx(ce,{}),e.jsx("span",{children:"SAVE NOTES"})]})]}),a.items&&a.items.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 font-saiyan mb-3",children:"Order Items"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:a.items.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.product_image&&e.jsx("img",{src:s.product_image,alt:s.product_name,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.product_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]})]})]}),e.jsx("p",{className:"font-bold",children:e.jsx(_,{value:parseFloat(s.subtotal)})})]},t))})]}),e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold font-saiyan",children:"TOTAL:"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600 font-saiyan",children:e.jsx(_,{value:parseFloat(a.total)})})]})})]})]})})]})}export{de as default};
